const R="growi-plugin-amazon-embed",U="1.0.0",G="GROWI plugin for embed amazon",S="MIT",T=["growi","growi-plugin"],N="module",E={dev:"vite",build:"tsc && vite build",preview:"vite preview"},L={react:"^18.3.1","react-dom":"^18.3.1","react-innertext":"^1.1.5",unified:"^11.0.5","unist-util-visit":"^5.0.0"},M={"@types/react":"^18.3.3","@types/react-dom":"^18.3.0","@typescript-eslint/eslint-plugin":"^5.0.0","@typescript-eslint/parser":"^5.0.0","@vitejs/plugin-react":"^4.3.1",eslint:"^8.18.0","eslint-config-next":"^14.2.4","eslint-config-weseek":"^2.1.0","eslint-import-resolver-typescript":"^3.2.5","eslint-plugin-import":"^2.29.1","eslint-plugin-jest":"^27.1.0","eslint-plugin-react":"^7.30.1","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-regex":"^1.10.0",jest:"^29.7.0",typescript:"^5.5.2",vite:"^5.3.2"},V={schemaVersion:"4",types:["script"]},f={name:R,version:U,description:G,license:S,keywords:T,type:N,scripts:E,dependencies:L,devDependencies:M,growiPlugin:V},P=function(n){if(n==null)return D;if(typeof n=="function")return y(n);if(typeof n=="object")return Array.isArray(n)?W(n):q(n);if(typeof n=="string")return B(n);throw new Error("Expected function, string, or object as test")};function W(n){const t=[];let o=-1;for(;++o<n.length;)t[o]=P(n[o]);return y(e);function e(...r){let i=-1;for(;++i<t.length;)if(t[i].apply(this,r))return!0;return!1}}function q(n){const t=n;return y(o);function o(e){const r=e;let i;for(i in n)if(r[i]!==t[i])return!1;return!0}}function B(n){return y(t);function t(o){return o&&o.type===n}}function y(n){return t;function t(o,e,r){return!!(X(o)&&n.call(this,o,typeof e=="number"?e:void 0,r||void 0))}}function D(){return!0}function X(n){return n!==null&&typeof n=="object"&&"type"in n}const I=[],_=!0,A=!1,H="skip";function K(n,t,o,e){let r;typeof t=="function"&&typeof o!="function"?(e=o,o=t):r=t;const i=P(r),s=e?-1:1;d(n,void 0,[])();function d(c,g,u){const l=c&&typeof c=="object"?c:{};if(typeof l.type=="string"){const a=typeof l.tagName=="string"?l.tagName:typeof l.name=="string"?l.name:void 0;Object.defineProperty(v,"name",{value:"node ("+(c.type+(a?"<"+a+">":""))+")"})}return v;function v(){let a=I,m,p,b;if((!t||i(c,g,u[u.length-1]||void 0))&&(a=J(o(c,u)),a[0]===A))return a;if("children"in c&&c.children){const h=c;if(h.children&&a[0]!==H)for(p=(e?h.children.length:-1)+s,b=u.concat(h);p>-1&&p<h.children.length;){const F=h.children[p];if(m=d(F,p,b)(),m[0]===A)return m;p=typeof m[1]=="number"?m[1]:p+s}}return a}}}function J(n){return Array.isArray(n)?n:typeof n=="number"?[_,n]:n==null?I:[n]}function Q(n,t,o,e){let r,i,s;typeof t=="function"&&typeof o!="function"?(i=void 0,s=t,r=o):(i=t,s=o,r=e),K(n,i,d,r);function d(c,g){const u=g[g.length-1],l=u?u.children.indexOf(c):void 0;return s(c,l,u)}}const k=function(){return n=>{Q(n,t=>{const o=t;if(o.name!=="amazon")return;const e=o.attributes.asin,r=o.attributes.title,i=o.attributes.url,s="amazon-"+Math.random().toString(36).slice(2);o.type="html",o.value=`<div id="${s}"></div>`;const d=setInterval(()=>{document.querySelector("#"+s)!=null&&(document.querySelector("#"+s).innerHTML=tn(e,r,i),clearInterval(d))},100)})}},Y=n=>{try{const t=new URL(n);if(t.host==="www.amazon.co.jp"){const o=t.pathname.split("/")[3];if(o)return o}}catch{}return""},Z=n=>{try{const t=new URL(n);if(t.host==="www.amazon.co.jp"){const o=decodeURI(t.pathname.split("/")[1]);if(o)return o}}catch{}return""},z=n=>{const t="978"+n.substring(0,9);return t+O(t)},nn=n=>{const t=n.substring(3,12);return t+x(t)},j=n=>n.endsWith(x(n)),C=n=>n.endsWith(O(n)),x=n=>{let t=0;for(let e=0;e<9;e++)t=t+(n.charCodeAt(e)-48)*(10-e);const o=11-t%11;return o==10?"X":String.fromCharCode(48+o)},O=n=>{var t=0;for(let e=0;e<12;e++)t=t+(n.charCodeAt(e)-48)*(e%2==0?1:3);const o=10-t%10;return String.fromCharCode(48+o)},tn=function(n,t,o){if(o){const e=Y(o),r=Z(o);if(j(e)){const i=z(e);return w(i,t||r,o)}else return C(e)?w(e,t||r,o):$(e,t||r,o)}if(j(n)){const e=z(n),r=`https://www.amazon.co.jp/dp/${n}`;return w(e,t,r)}else if(C(n)){const r=`https://www.amazon.co.jp/dp/${nn(n)}`;return w(n,t,r)}else{const e=`https://www.amazon.co.jp/dp/${n}`;return $(n,t,e)}},w=function(n,t,o){const e=[];return e.push('<div class="amazon">'),e.push(`<a href="${o}">`),e.push(`<img src="https://img.hanmoto.com/bd/img/${n}.jpg"/>`),e.push("<br>"),e.push(`${t||n}`),e.push("</a>"),e.push("</div>"),e.join("")},$=function(n,t,o){const e=[];return e.push('<div class="amazon">'),e.push(`<a href="${o}">`),e.push(`${t||n}`),e.push("</a>"),e.push("</div>"),e.join("")},en=()=>{if(console.log(`Activating ${f.name} v${f.version}...`),growiFacade==null||growiFacade.markdownRenderer==null)return;const{optionsGenerators:n}=growiFacade.markdownRenderer,t=n.customGenerateViewOptions,o=n.customGeneratePreviewOptions;n.customGenerateViewOptions=(...e)=>{const r=t?t(...e):n.generateViewOptions(...e);return r.remarkPlugins.push(k),console.log(`${f.name} added to view options:`,r.remarkPlugins),r},n.customGeneratePreviewOptions=(...e)=>{const r=o?o(...e):n.generatePreviewOptions(...e);return r.remarkPlugins.push(k),r},console.log(`${f.name} activated.`)},on=()=>{};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators[f.name]={activate:en,deactivate:on};console.log(`${f.name} v${f.version} is loaded.`);
